<!-- Additional HEAD content -->
{% block head %}
{% set css %}
{% include "shared/css/location.css" %}
{% include "shared/css/leaflet/leaflet.css" %}
{% endset %}<style>{{ css | cssmin | safe }}</style>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
{% endblock %}

<!-- Main -->
<main class="location">

  <section class="location">
    <div class="container-main">

    <!-- First -->
    {% include 'shared/sections/location/first.html.njk' %}

    <!-- Buildings -->
    {% include 'shared/sections/location/buildings.html.njk' %}

    </div>
  </section>

  <!-- Map -->
  <section class="map">

    <!-- Map -->
    <div class="map" id="map"></div>

    <!-- Popups -->
    {% for b in buildings-%}
    {% if b.District.Location.Name == location.Name %}

    {% set min = 9999 %}
    {% for r in rooms %}
    {% if r.id == b.id %}
      {% for p in r.Place_types %}
      {% for f in p.Flat_types %}
        {% if min > f.Rent_long %}
          {% set min = f.Rent_long %}
        {% endif %}
      {% endfor %}
      {% endfor %}
    {% endif %}
    {% endfor %}

    <div id="{{b.id}}" style="display: none;">
      <div class="mappopup" onclick="location.href='{{langs[L].folder}}/{{b.Name|ascii}}.html';">
        {% image
          constants.SERVER + "/wopi/files/Marketing/Media_building/" + b.Photos[0].id +"/Image/contents?access_token=" + token,
          b.Name, b.Name, "",
          [200], ""
        %}
        <div class="info">
          <div class="address">{{b.Name}}</div>
          <div class="from">{% literal texts, 'price-desde', L %}</div>
          <div class="price">{{min}}â‚¬/{% literal texts, 'price-mes', L %}</div>
        </div>
      </div>
    </div>
    {% endif %}
    {% endfor %}

  </section>

  <!-- Services -->
  {% include 'shared/sections/location/services.html.njk' %}

</main>

<!-- Scripts -->
{% block footer %}
{% set script %}

{% include "shared/js/map.js" %}

// Map
var map = createMap("map", 41.3933, 2.1377, 16);
var markerArray = [];
{% for b in buildings %}
{% if b.District.Location.Name == location.Name %}
markerArray.push(putMarker(
  map,
  {{b.Lat_lon.slice(1,-1).split(',')[0]}},
  {{b.Lat_lon.slice(1,-1).split(',')[1]}},
  document.getElementById("{{b.id}}").innerHTML
));
{% endif %}
{% endfor %}
if (markerArray.length > 0) {
  var group = L.featureGroup(markerArray).addTo(map);
  map.fitBounds(group.getBounds());
}
{% endset %}<script>{{ script | jsmin | safe }}</script>
{% endblock %}
